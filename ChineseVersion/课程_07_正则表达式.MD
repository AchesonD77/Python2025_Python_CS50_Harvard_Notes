# 第 7 讲 — 正则表达式、清洗输入、提取数据

> *目标：* 学会用 Python 的 `re` 模块来**校验**、**清洗**与**提取**用户输入。

## 目录
- [正则表达式基础](#正则表达式基础)
- [大小写敏感](#大小写敏感)
- [清洗用户输入](#清洗用户输入)
- [提取用户输入](#提取用户输入)
- [总结](#总结)

- 可以参考链接：https://cs50.harvard.edu/python/notes/7/
---

## 正则表达式基础

正则（*regex*）用于匹配**模式**，而不是简单找子串。

### 1）朴素检查
```py
email = input("What's your email? ").strip()
if "@" in email:
    print("Valid")
else:
    print("Invalid")
```
- 问题：仅 `@` 也会通过。改进为同时包含 `@` 与 `.`：
```py
email = input("What's your email? ").strip()
if "@" in email and "." in email:
    print("Valid")
else:
    print("Invalid")
```
仍不严谨。

### 2）拆分成用户名与域名
```py
email = input("What's your email? ").strip()
username, domain = email.split("@")
if username and "." in domain:
    print("Valid")
else:
    print("Invalid")
```
依旧接受如 `malan@harvard?edu` 之类的坏输入。

### 3）使用 `re.search`
<mark>核心：用**模式**描述合法结构。</mark>
```py
import re
email = input("What's your email? ").strip()
if re.search(r"@.+", email):
    print("Valid")
else:
    print("Invalid")
```
常用语法：

- `.` 任意字符（不含换行）  
- `*`/`+`/`?`、`{m}`、`{m,n}` 重复次数  
- `^` 行首，`$` 行尾  
- 字符类 `[abc]`、排除 `[^abc]`、范围 `[a-zA-Z0-9_]`  
- `\w` 字符、`\W` 非字符、`\d` 数字、`\D` 非数字、`\s` 空白、`\S` 非空白。

### 4）收紧邮箱规则
```py
import re
email = input("What's your email? ").strip()
if re.search(r"^[\w]+@[\w]+\.edu$", email):
    print("Valid")
else:
    print("Invalid")
```
- `^...$` 确保**整串**匹配。
- <mark>要点：</mark> 使用 **原始字符串** `r"...“`，避免反斜杠被 Python 吃掉。

### 5）更通用的后缀
```py
if re.search(r"^[\w]+@[\w]+\.(com|edu|gov|net|org)$", email):
    ...
```
或
```py
if re.fullmatch(r"[A-Za-z0-9_]+@[A-Za-z0-9_]+\.[A-Za-z]{2,}", email):
    print("Valid")
else:
    print("Invalid")
```
- <mark>推荐：</mark>需要匹配**整个字符串**时用 **`re.fullmatch`**。

## 大小写敏感

默认区分大小写。用 `re.IGNORECASE` 忽略大小写：
```py
import re
if re.search(r"^[\w]+@[\w]+\.edu$", email, re.IGNORECASE):
    print("Valid (case-insensitive)")
```
其他常用：`re.MULTILINE`, `re.DOTALL`。

## 清洗用户输入

把“**Malan, David**”标准化为“**David Malan**”。

**方式 1：split**
```py
name = input("What's your name? ").strip()
if "," in name:
    last, first = name.split(", ")
    name = f"{first} {last}"
print(f"Hello, {name}")
```

**方式 2：正则分组**
```py
import re
name = input("What's your name? ").strip()
m = re.search(r"^(.+),\s*(.+)$", name)
if m:
    name = m.group(2) + " " + m.group(1)
print(f"Hello, {name}")
```
- `\s*` 吃掉多余空格。
- **海象运算符**一次完成匹配与判断：
```py
if m := re.search(r"^(.+),\s*(.+)$", name):
    name = f"{m.group(2)} {m.group(1)}"
```

## 提取用户输入

从 Twitter URL 中抽取**用户名**。

**替换法（脆弱）**
```py
url = input("URL: ").strip()
username = url.replace("https://twitter.com/", "")
print("Username:", username)
```

**正则替换**
```py
import re
url = input("URL: ").strip()
username = re.sub(r"^https?://(www\.)?twitter\.com/", "", url, flags=re.IGNORECASE)
print("Username:", username)
```

**验证 + 捕获**
```py
import re
url = input("URL: ").strip()
if m := re.search(r"^https?://(?:www\.)?twitter\.com/([a-z0-9_]+)$", url, re.IGNORECASE):
    print("Username:", m.group(1))
```
- `(?:...)` 非捕获分组；`[a-z0-9_]+` 合法字符 1+。
- <mark>最佳实践：</mark>尽量在**同一个**正则里完成“校验 + 提取”。

## 总结

- **正则基础**：元字符、重复、锚点、字符类与分组。  
- **标志位**：<mark>re.IGNORECASE</mark>、`re.MULTILINE`、`re.DOTALL`。  
- **清洗输入**：分组与**海象运算符**结合更优雅。  
- **提取结构化数据**：用一个精确的正则完成匹配与捕获。

> 提示：保持模式**可读**；优先使用**原始字符串**与**锚点**；验证整串时用 **`re.fullmatch`**。
